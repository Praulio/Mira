---
name: ralph-loop
description: |
  Autonomous implementation system for iterative feature development.
  EXECUTION phase of the unified pipeline: /interview ‚Üí /workflows:plan ‚Üí /plan-to-ralph ‚Üí ./ralph-loop.sh

  Use when:
  - Implementing features with >5 tasks
  - You need fresh sessions per task to avoid context overflow
  - User mentions "ralph loop", "autonomous implementation", "iterative development"
  - User runs "./ralph-loop.sh" or "/plan-to-ralph"
  - Creating or reviewing spec files in docs/specs/current/

  Related commands: /interview, /plan-to-ralph, /workflows:plan, /workflows:compound
---

# Ralph Loop: Autonomous Implementation

Execute features autonomously through iterative, fresh LLM sessions guided by spec files.

## Quick Overview

**What is Ralph Loop?**
A system where you (Claude) execute feature tasks ONE AT A TIME in fresh sessions. Each session reads spec files, completes ONE task, commits, and exits. A shell script loops until all tasks are done.

**The Model:**
```
Spec Files ‚Üí Iterative Execution ‚Üí Compound Knowledge
     ‚Üì              ‚Üì                    ‚Üì
  4 markdown    Fresh session       docs/solutions/
    files       per task            (permanent)
```

**CRITICAL MINDSET:**
> **Ralph is LITERAL.** You do NOT assume, infer, or fill gaps. If the spec says "add CSS variables", you add CSS variables. If the spec does NOT say "activate dark mode with className='dark'", you do NOT add it. Missing steps = missing features.

**When to use:**
- Features with >5 distinct tasks
- Features taking >2 hours
- Clear spec with established patterns

**When NOT to use:**
- Exploratory work (unclear requirements)
- Tiny features (<30 min, 1-2 tasks)
- Constant human decisions needed

---

## Pipeline Integration

Ralph Loop is the **execution engine** within the unified feature pipeline:

```
PREPARATION                    EXECUTION              POST
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
/interview spec.md            ./ralph-loop.sh        /workflows:review
       ‚Üì                             ‚Üì                      ‚Üì
/workflows:plan spec.md       Fresh sessions         /workflows:compound
       ‚Üì                      per task                     ‚Üì
/plan-to-ralph spec.md                              docs/solutions/
       ‚Üì
docs/specs/current/           ‚Üê ALL FILES HERE
‚îú‚îÄ‚îÄ spec.md (feature context)
‚îú‚îÄ‚îÄ implementation_plan.md
‚îú‚îÄ‚îÄ prompt.md
‚îî‚îÄ‚îÄ discoveries.md
```

**Compound Engineering = üß† Planning + Review + Knowledge**
**Ralph Loop = üí™ Autonomous Execution**

### Pipeline Commands

| Command | Phase | Purpose |
|---------|-------|---------|
| `/interview [spec.md]` | Prep | UX/product interview (non-technical) |
| `/workflows:plan [spec.md]` | Prep | Technical architecture |
| `/plan-to-ralph [spec.md]` | Prep | Generate executable tasks |
| `./ralph-loop.sh [folder]` | Exec | Autonomous implementation |
| `/workflows:review` | Post | Review generated code |
| `/workflows:compound` | Post | Document learnings |

### Typical Flow

```bash
# 1. Setup workspace (if starting fresh)
# docs/specs/current/ already exists - just clean it if needed

# 2. Create spec file
touch docs/specs/current/spec.md

# 3. Interview (UX/product questions)
/interview docs/specs/current/spec.md

# 4. Technical planning (generates docs/plans/feat-*.md)
/workflows:plan docs/specs/current/spec.md

# 5. Generate Ralph tasks (populates current/ with 4 files)
/plan-to-ralph docs/plans/feat-my-feature.md

# 6. Execute autonomously (defaults to current/, no arg needed)
./ralph-loop.sh

# 7. Post-execution
/workflows:review
/workflows:compound

# 8. Cleanup current/ for next feature
rm docs/specs/current/implementation_plan.md
rm docs/specs/current/prompt.md
rm docs/specs/current/discoveries.md
# spec.md ‚Üí delete or archive depending on value
```

---

## The File System

**CRITICAL: `docs/specs/current/` is THE active workspace.** All 4 files live here during implementation.

| File | Purpose | Author | Lifecycle |
|------|---------|--------|-----------|
| `spec.md` | Feature spec (vision, UX, architecture) | Human via `/interview` + `/workflows:plan` | **Moves out after completion** |
| `prompt.md` | Instructions for each iteration | Generated by `/plan-to-ralph` | Temporary |
| `implementation_plan.md` | Tasks with `- [ ]` checkboxes | Generated, you update | Temporary |
| `discoveries.md` | Memory between sessions | You write | Temporary |

**File Relationships:**
```
docs/specs/current/              ‚Üê ACTIVE WORKSPACE (always this folder)
    ‚îÇ
    ‚îú‚îÄ‚îÄ spec.md                  ‚Üê Feature context (moves to archive after completion)
    ‚îÇ       ‚îÇ
    ‚îÇ       ‚îî‚îÄ‚îÄ Created by /interview + /workflows:plan
    ‚îÇ
    ‚îú‚îÄ‚îÄ prompt.md                ‚Üê Generated by /plan-to-ralph
    ‚îÇ
    ‚îú‚îÄ‚îÄ implementation_plan.md   ‚Üê You mark [x] when done
    ‚îÇ
    ‚îú‚îÄ‚îÄ discoveries.md           ‚Üê You append learnings
    ‚îÇ
    ‚îî‚îÄ‚îÄ README.md                ‚Üê Lookup table (stays permanently)
```

**Why `current/` instead of `docs/specs/[feature]/`:**
- `ralph-loop.sh` defaults to `docs/specs/current/` (no argument needed)
- One feature at a time = cleaner context
- No need to pass folder path every time

**Lifecycle:**
```
During Implementation:
  docs/specs/current/
  ‚îú‚îÄ‚îÄ spec.md                 ‚Üê Feature being built
  ‚îú‚îÄ‚îÄ implementation_plan.md  ‚Üê Active tasks
  ‚îú‚îÄ‚îÄ prompt.md               ‚Üê Ralph instructions
  ‚îî‚îÄ‚îÄ discoveries.md          ‚Üê Memory

After Feature Complete:
  1. /workflows:compound       ‚Üí discoveries.md ‚Üí docs/solutions/ (permanent)
  2. Delete temporary files:   implementation_plan.md, prompt.md, discoveries.md
  3. Move or delete spec.md    ‚Üí archive OR delete if docs/solutions/ captured everything
  4. Clean `current/` for next feature
```

**Key Insight:** You have NO memory between sessions. `discoveries.md` IS your memory.

---

## Core Rules (UNBREAKABLE)

### 1. ONE TASK = ONE LOOP
Never complete multiple tasks. Find first `- [ ]`, execute ONLY that, commit, exit.

### 2. FRESH SESSION
Your context is destroyed after commit. Write everything important to `discoveries.md`.

### 3. ATOMIC COMMITS
ONE commit containing: code changes + updated plan + updated discoveries.

### 4. SEQUENTIAL EXECUTION
Always pick the FIRST unchecked `- [ ]` task. Never skip ahead.

### 5. VERIFY BEFORE COMMIT
Run verification commands (lint, build, test) before marking complete.

### 6. BUG AUTO-HEALING
If tests fail, attempt up to 10 fixes before escalating. Document each attempt.

### 7. DISCOVERIES MANDATORY
Step 4.5 (update discoveries) is NEVER optional. Even "no issues found" is documented.

---

## Iteration Workflow

Each iteration follows this exact flow:

```
PASO 0: Read PIN + Discoveries
         ‚Üì
PASO 1: Identify ONE task (first [ ])
         ‚Üì
PASO 2: Execute ONLY that task
         ‚Üì
PASO 3: Verify quality (lint && build)
         ‚Üì
PASO 4: Testing (per task type)
         ‚Üì
PASO 4.5: Update discoveries (MANDATORY)
         ‚Üì
PASO 4.6: Bug Auto-Healing (if errors)
         ‚Üì
PASO 5: Atomic commit
         ‚Üì
PASO 6: EXIT (session ends)
```

### PASO 0: Read Context
```bash
# Read in this order (all files in current/):
1. docs/specs/current/spec.md (feature context)
2. docs/specs/current/discoveries.md (what previous sessions learned)
3. docs/specs/current/implementation_plan.md (find next task)
```

### PASO 1: Identify Task
```bash
# Find first unchecked task
grep -n "- \[ \]" docs/specs/current/implementation_plan.md | head -1

# Example output:
# 45:- [ ] **2.3** Create EventForm component
```

### PASO 2: Execute Task
- Read ONLY files needed for this task
- Make changes specified in task
- Follow BEFORE/AFTER code if provided
- Do NOT add extra features

### PASO 3: Verify Quality
```bash
# Adapt to your stack:
# Node.js: pnpm lint && pnpm build
# Python: ruff check . && python -m py_compile
# Ruby: rubocop && rails assets:precompile
```

### PASO 4: Testing
See [testing-criteria.md](references/testing-criteria.md) for matrix.

### PASO 4.5: Update Discoveries (MANDATORY)
```markdown
## Session [N] - [Date]

### Task Completed
[X.Y] [Task description]

### Patterns Discovered
- [Pattern name]: [Brief description]

### Issues Encountered
- [Issue]: [How resolved]

### Notes for Next Session
- [Important context]
```

### PASO 4.6: Bug Auto-Healing
If verification fails, see [bug-auto-healing.md](references/bug-auto-healing.md).

### PASO 5: Atomic Commit
```bash
git add docs/specs/current/implementation_plan.md docs/specs/current/discoveries.md [code files]
git commit -m "feat(scope): [task description]

- [Change 1]
- [Change 2]

Task X.Y completed

Co-Authored-By: Claude <noreply@anthropic.com>"
```

### PASO 6: EXIT
Session ends. Script will start new session if tasks remain.

---

## Output Signals

Use these signals in your output for clarity:

```
RALPH_START: Iniciando sesi√≥n Ralph Loop
RALPH_READING: Leyendo [archivo]
RALPH_TASK: Ejecutando tarea [X.Y] - [descripci√≥n]
RALPH_ACTION: [descripci√≥n de acci√≥n]
RALPH_RESULT: [resultado de acci√≥n]
RALPH_VERIFY: Ejecutando verificaci√≥n
RALPH_BUG_DETECTED: [s√≠ntomas del error]
RALPH_ROOT_CAUSE: [explicaci√≥n]
RALPH_FIX_ATTEMPT: [N/10] - [descripci√≥n del fix]
RALPH_BUG_FIXED: Fix exitoso, continuando
RALPH_COMMIT: [hash] - [mensaje]
RALPH_COMPLETE: Tarea [X.Y] completada
RALPH_BLOCKED: Escalando al usuario - [raz√≥n]
```

---

## Spec Quality (CRITICAL)

### Spec Specificity Score

Before executing, evaluate each task's quality:

| Criterion | Points |
|-----------|--------|
| Has BEFORE/AFTER code | 1 |
| Specifies line/element location | 1 |
| Decides implementation strategy | 1 |
| Has validation criteria | 1 |
| Includes "why" context | 1 |

**Scoring:**
| Score | Quality | Expectation |
|-------|---------|-------------|
| 4-5 | Excellent | Execute without ambiguity |
| 2-3 | Acceptable | May need to infer some details |
| 0-1 | Poor | High risk of wrong output |

**Target:** Average ‚â•4/5 before starting Ralph Loop.

### Fase 0 Requirement

**EVERY spec must start with Fase 0: Activation & Smoke Test**

```markdown
## Fase 0: Activation & Smoke Test (CRITICAL)

- [ ] **0.1** [Activation/integration step]
- [ ] **0.2** Smoke test - [minimal verification]
```

**Examples by feature type:**
- Dark mode ‚Üí Add `className="dark"` to `<html>`
- Auth context ‚Üí Wrap layout with Provider
- Analytics ‚Üí Inject script tag
- i18n ‚Üí Setup next-intl provider

**Why:** Features often need ONE activation step that spec writers assume is "obvious". Ralph doesn't assume. No Fase 0 = feature won't work.

For complete validation checklist, see [spec-validation.md](references/spec-validation.md).

---

## Quick Start

### Option A: Full Pipeline (Recommended)

```bash
# 1. Create spec in current/ workspace
touch docs/specs/current/spec.md

# 2. Run interview (UX/product questions)
/interview docs/specs/current/spec.md

# 3. Add technical architecture (creates docs/plans/feat-*.md)
/workflows:plan docs/specs/current/spec.md

# 4. Generate Ralph tasks (populates current/ with all 4 files)
/plan-to-ralph docs/plans/feat-my-feature.md

# 5. Execute (defaults to current/, no path needed)
./ralph-loop.sh
```

### Option B: Manual Setup

If you prefer to write specs manually:

```bash
# 1. Setup files in current/ workspace
touch docs/specs/current/spec.md
touch docs/specs/current/prompt.md
touch docs/specs/current/implementation_plan.md
touch docs/specs/current/discoveries.md

# 2. Copy templates
# See references/spec-templates.md

# 3. Write your feature spec
# - Start with Fase 0 (activation)
# - Include BEFORE/AFTER code in tasks
# - Target Spec Specificity Score ‚â•4/5

# 4. Validate
# See references/spec-validation.md

# 5. Run (no path needed - defaults to current/)
./ralph-loop.sh
```

### Monitor Progress

```bash
# Check task progress
grep -c "\- \[x\]" docs/specs/current/implementation_plan.md
grep -c "\- \[ \]" docs/specs/current/implementation_plan.md

# Read discoveries
cat docs/specs/current/discoveries.md

# Watch log
tail -f ralph-log.txt
```

---

## Task Template

Use this structure for high-quality tasks (Score 5/5):

```markdown
- [ ] **X.Y** [Brief, specific description]

**Context:**
- Why: [Reason this task exists]
- Current: [What exists now]
- Target: [Desired end state]

**Files:**
- Primary: [main file]
- Secondary: [other files]

**Changes:**
- Location: [Line number or element]
- Strategy: [CSS class / Inline / API call / etc.]
- BEFORE:
  ```[lang]
  [exact current code]
  ```
- AFTER:
  ```[lang]
  [exact expected code]
  ```

**Validation:**
- [ ] Build: `[command]` passes
- [ ] Visual: [specific criterion]
- [ ] Functional: [test criterion]

**Pitfalls:**
- [Common mistake and how to avoid]
```

For complete template with examples, see [task-template.md](references/task-template.md).

---

## References

Detailed documentation in `references/`:

| File | Content |
|------|---------|
| [spec-templates.md](references/spec-templates.md) | Complete templates for 4 spec files |
| [task-template.md](references/task-template.md) | High-quality task template + scoring |
| [iteration-workflow.md](references/iteration-workflow.md) | Detailed PASO 0-6 flow |
| [bug-auto-healing.md](references/bug-auto-healing.md) | 10-attempt fix loop |
| [testing-criteria.md](references/testing-criteria.md) | Testing matrix + checkpoints |
| [anti-patterns.md](references/anti-patterns.md) | What NOT to do |
| [spec-validation.md](references/spec-validation.md) | Pre-flight checklist |

---

## Troubleshooting

### "Feature doesn't work despite all tasks completed"
**Cause:** Missing activation step (Fase 0)
**Fix:** Add Fase 0 with activation + smoke test

### "Task output is wrong"
**Cause:** Spec Specificity Score <3
**Fix:** Add BEFORE/AFTER code, specify location

### "Context overflow mid-feature"
**Cause:** Not using fresh sessions
**Fix:** Ensure script kills session after each commit

### "Lost important information"
**Cause:** Not updating discoveries.md
**Fix:** ALWAYS update discoveries, even if "nothing happened"

### "Repeated same mistake"
**Cause:** Not reading discoveries from previous sessions
**Fix:** PASO 0 must include reading discoveries.md

---

## Post-Execution

After all tasks complete:

### 1. Review Code
```bash
/workflows:review  # Multi-agent code review
```

### 2. Extract Learnings
```bash
/workflows:compound  # Move discoveries ‚Üí docs/solutions/
```

### 3. Cleanup current/ for Next Feature
```bash
# Delete temporary execution files
rm docs/specs/current/implementation_plan.md
rm docs/specs/current/prompt.md
rm docs/specs/current/discoveries.md

# spec.md decision:
# - If docs/solutions/ captured everything ‚Üí delete
# - If spec has long-term value ‚Üí move to archive or leave
```

**Lifecycle:**
```
discoveries.md (temp) ‚Üí /workflows:compound ‚Üí docs/solutions/*.md (permanent)

current/ workspace ‚Üí clean ‚Üí ready for next feature
```

**Why cleanup matters:**
- Next feature reuses `current/` workspace
- Stale files from previous feature cause confusion
- `README.md` stays (lookup table), everything else can go

---

## Version

- **Version:** 1.2.0
- **Based on:** Ralph Loop v0.2.0 + Pipeline Integration
- **Changes:**
  - v1.2.0: Clarified `docs/specs/current/` as THE active workspace (not per-feature folders)
  - v1.1.0: Integrated with /interview, /plan-to-ralph, unified pipeline
